<% def greeting %>
  <% current_time = Time.now.to_i %>
  <% midnight = Time.now.beginning_of_day.to_i %>
  <% noon = Time.now.middle_of_day.to_i %>
  <% five_pm = Time.now.change(:hour => 17 ).to_i %>

  <% case %>
    <% when midnight.upto(noon).include?(current_time) %>
      <% return "Good Morning" %>
    <% when noon.upto(five_pm).include?(current_time) %>
      <% return "Good Afternoon" %>
    <% when five_pm.upto(midnight + 1.day).include?(current_time) %>
      <% return "Good Evening" %>
  <% end %>
<% end %>


  <h2 class="center mt-4"><%= greeting %>, <%= @user.first_name %></h2>

  <div class="container mt-4 border-bottom border-primary border-10 d-flex justify-content-start">
    <button class="btn user-tab" data-target="symptoms">Symptoms
      <% if SymptomCheck.where(user: current_user).last.created_at.to_date != Date.today %>
        <div class="notification1">
          <%= current_user.symptoms.count - (SymptomCheck.where(user: current_user, created_at: Date.today.to_datetime)).count %>
        </div>
      <% end %>
    </button>
    <button class="btn user-tab" data-target="prescriptions">Prescriptions
      <div class="notification2">
        3
      </div>
    </button>
    <button class="btn user-tab" data-target="appointments">Appointments
      <div class="notification3">
        1
      </div>
    </button>
  </div>

  <div class="container" style="margin-top: 24px;">

    <div class="user-ul active" id="symptoms">
      <div class="dashboard-card">
      <% if SymptomCheck.where(user: current_user).last.created_at.to_date != Date.today # this is not working properly %>
        <%= simple_form_for @symptom_check do |f| %>
          <%= f.input :rating, label: 'How is your cough today?', as: :range, input_html: { min: 1, max: 5, id: 'rating-slider' }, required: false %>
          <p id='slider-text'>Same as usual</p>
          <%= f.button :submit, value: 'Submit', class: 'btn-ghost-small' %>
        <% end %>
      <% else %>
        <h5>Well done! You have done your check for <%= SymptomCheck.where(user: current_user).last.symptom.name.downcase %> today üëè</h5>
      <% end %>
      </div>

        <% @sliced = [] %>
        <% @symptom_checks.each do |check| %>
          <% @sliced << [check.created_at.to_date, check.rating] %>
        <% end %>
        <div class="dashboard-card" id="symptom-chart">
          <h5>History</h5>
          <%= line_chart @sliced, ytitle: "Severity", height: "200px", colors: ["#0da4c8", "#0da4c8"], showLines: 'false',
          library:
          { scales:
            { yAxes: [{ display: false }] }
          } %>
        </div>

    <div class="user-ul" id="prescriptions">
      <p>Something</p>
    </div>

    <div class="user-ul" id="appointments">
      <p>Something else</p>
    </div>

  </div>


